<html>
<head>
	<title>Here Say</title>
	<!--jquery-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<!--leaflet-->
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<!--jQuery CSV plugin-->
	<script src="js/jquery.csv-0.71.min.js"></script>
	<!-- Leaflet MarkerCluster plugin -->
	<link rel="stylesheet" href="css/MarkerCluster.Default.css" />
	<link rel="stylesheet" href="css/MarkerCluster.css" />
	<script src="js/leaflet.markercluster.js"></script>

	<!--TabletopJS plugin-->
	<script src="js/tabletop.js"></script>

	<!--Bootstrap-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

	<!--my style sheet-->
	<link rel="stylesheet" type="text/css" href="css/style.css">

</head>
<body>
	<div class="cont">
		<div id="info" class="absolute">
			<div class='container'>
				<h2 class='center'>Headline</h2>
				
				<div class="panel panel-success">
					<div class="panel-heading">Panel title</div>
					<div class="panel-body">
						Panel content
					</div>
				</div>

			</div>
			<ul id="list"></ul>
			<p>Here's some information</p>
		</div>
		<div id="map"></div>
	</div>
</body>

<script type="text/javascript">

	Tabletop.init({
		key: '1FJUJVi6gM-Ese7-RnEyDQHcR1u2uKlnoOFowGEf89vg',
		callback: function(data, tabletop){

			var map = L.map('map',{
				center: [38.946286, -92.328677],
				zoom: 14,
				maxZoom: 16,
				minZoom: 14
			});

			L.tileLayer('http://{s}.tile.openstreetmap.com/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>, &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
					subdomians: 'abcd',
			}).addTo(map);

			var markers = new L.MarkerClusterGroup({
				spiderfyOnMaxZoom: true,
				spiderfyDistanceMultiplier: 4,
				showCoverageOnHover: false,

			});

			for (var i=0; i<data.length; i++) {

				var lat = data[i].Lat;
				var lon = data[i].Lon;

// Delete this dummy URL and get a proper one in, for users with no image
				if (data[i].Image == "") {
					data[i].Image = 'http://concentricsky.com/static/img/no-user-photo.png'
				}

				var marker_face_icon = L.icon({
					iconUrl: data[i].Image,
					iconSize: [40, 40],
					iconAnchor: [20, 20]
				});

				var marker = L.marker([lat, lon], {
							title: null,
							icon: marker_face_icon
						 });

				marker.Story = data[i].Story;
				marker.Soundcloud = data[i].Soundcloud;
				marker.Headline = data[i].Headline;
			
				marker.on('click', function(e) {
					var text = this.Story;
					var sc = this.Soundcloud;
					var my_html = '<li class="list_item">'+text+'</li><li>'+sc+'</li>';
					$('#list').html(my_html);
				});
				
				markers.addLayer(marker);
			}

			markers.on('clusterclick', function(a){
				var markers = a.layer.getAllChildMarkers();
				$('#list').html('');
				$.each(markers, function(index, marker){
					$('#list').append('<li class="list_item">'+this.Headline+'</li>')
				});
				
			});

			map.addLayer(markers);

		},
		simpleSheet: true
	});




	

</script>
</html>
















